<%- include('./partials/header', { title: 'API Documentation' }) %>

<div class="container-fluid" id="api-docs-page">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3">API Documentation</h1>
        <div class="input-group w-50">
          <span class="input-group-text"><i class="bi bi-search"></i></span>
          <input type="text" class="form-control" id="api-search" placeholder="Search API endpoints...">
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-body">
          <h2 class="h5 mb-3">Introduction</h2>
          <p>Welcome to the WhatsApp Web API documentation. This API allows you to interact with WhatsApp through a simple REST interface.</p>
          <p>All API endpoints require authentication using a JWT token, which you can obtain by logging in through the <code>/api/auth/login</code> endpoint.</p>
          
          <h3 class="h6 mt-4">Base URL</h3>
          <pre><code class="language-http">https://your-domain.com/api</code></pre>
          
          <h3 class="h6 mt-4">Authentication</h3>
          <p>Include your JWT token in the Authorization header for all API requests:</p>
          <pre><code class="language-http">Authorization: Bearer YOUR_JWT_TOKEN</code></pre>
        </div>
      </div>
    </div>
  </div>

  <!-- API Categories Tabs -->
  <div class="row mb-4">
    <div class="col-12">
      <ul class="nav nav-tabs api-category-tabs">
        <li class="nav-item">
          <a class="nav-link active" href="#" data-target="all">All Endpoints</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-target="auth">Authentication</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-target="whatsapp">WhatsApp</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-target="user">User</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-target="admin">Admin</a>
        </li>
      </ul>
    </div>
  </div>

  <!-- Authentication API -->
  <div class="row api-category" data-category="auth">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-header">
          <h2 class="h5 mb-0">Authentication API</h2>
        </div>
        <div class="card-body">
          <!-- Login Endpoint -->
          <div class="api-endpoint mb-4">
            <div class="api-endpoint-header d-flex align-items-center">
              <span class="badge bg-success me-2 endpoint-method">POST</span>
              <span class="endpoint-path fw-bold">/api/auth/login</span>
              <span class="ms-auto"><i class="bi bi-chevron-right"></i></span>
            </div>
            <div class="api-endpoint-details mt-3 p-3 bg-light rounded">
              <p class="endpoint-description">Authenticate a user and get a JWT token</p>
              
              <h6>Request Body</h6>
              <pre><code class="language-json">{
  "username": "string",
  "password": "string"
}</code></pre>
              
              <h6>Response (200 OK)</h6>
              <pre><code class="language-json">{
  "success": true,
  "token": "JWT_TOKEN",
  "user": {
    "id": 1,
    "username": "user",
    "email": "user@example.com",
    "role": "user"
  }
}</code></pre>
              
              <h6>Response (401 Unauthorized)</h6>
              <pre><code class="language-json">{
  "success": false,
  "message": "Invalid username or password"
}</code></pre>
            </div>
          </div>
          
          <!-- Register Endpoint -->
          <div class="api-endpoint mb-4">
            <div class="api-endpoint-header d-flex align-items-center">
              <span class="badge bg-success me-2 endpoint-method">POST</span>
              <span class="endpoint-path fw-bold">/api/auth/register</span>
              <span class="ms-auto"><i class="bi bi-chevron-right"></i></span>
            </div>
            <div class="api-endpoint-details mt-3 p-3 bg-light rounded">
              <p class="endpoint-description">Register a new user</p>
              
              <h6>Request Body</h6>
              <pre><code class="language-json">{
  "username": "string",
  "email": "string",
  "password": "string"
}</code></pre>
              
              <h6>Response (201 Created)</h6>
              <pre><code class="language-json">{
  "success": true,
  "message": "User registered successfully",
  "user": {
    "id": 2,
    "username": "newuser",
    "email": "newuser@example.com",
    "role": "user"
  }
}</code></pre>
              
              <h6>Response (400 Bad Request)</h6>
              <pre><code class="language-json">{
  "success": false,
  "message": "Username already exists"
}</code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- WhatsApp API -->
  <div class="row api-category" data-category="whatsapp">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-header">
          <h2 class="h5 mb-0">WhatsApp API</h2>
        </div>
        <div class="card-body">
          <!-- Start Session Endpoint -->
          <div class="api-endpoint mb-4">
            <div class="api-endpoint-header d-flex align-items-center">
              <span class="badge bg-success me-2 endpoint-method">POST</span>
              <span class="endpoint-path fw-bold">/api/whatsapp/session/start</span>
              <span class="ms-auto"><i class="bi bi-chevron-right"></i></span>
            </div>
            <div class="api-endpoint-details mt-3 p-3 bg-light rounded">
              <p class="endpoint-description">Start a new WhatsApp session</p>
              
              <h6>Request Body</h6>
              <pre><code class="language-json">{
  "sessionName": "string"
}</code></pre>
              
              <h6>Response (200 OK)</h6>
              <pre><code class="language-json">{
  "success": true,
  "message": "Session started",
  "sessionId": "string"
}</code></pre>
              
              <h6>Response (400 Bad Request)</h6>
              <pre><code class="language-json">{
  "success": false,
  "message": "Session name is required"
}</code></pre>
            </div>
          </div>
          
          <!-- Send Message Endpoint -->
          <div class="api-endpoint mb-4">
            <div class="api-endpoint-header d-flex align-items-center">
              <span class="badge bg-success me-2 endpoint-method">POST</span>
              <span class="endpoint-path fw-bold">/api/whatsapp/session/:id/send</span>
              <span class="ms-auto"><i class="bi bi-chevron-right"></i></span>
            </div>
            <div class="api-endpoint-details mt-3 p-3 bg-light rounded">
              <p class="endpoint-description">Send a WhatsApp message</p>
              
              <h6>Path Parameters</h6>
              <ul>
                <li><code>id</code> (string, required): The session ID</li>
              </ul>
              
              <h6>Request Body</h6>
              <pre><code class="language-json">{
  "to": "string", // Phone number with country code
  "message": "string",
  "mediaUrl": "string" // Optional, for media messages
}</code></pre>
              
              <h6>Response (200 OK)</h6>
              <pre><code class="language-json">{
  "success": true,
  "message": "Message sent",
  "messageId": "string"
}</code></pre>
              
              <h6>Response (400 Bad Request)</h6>
              <pre><code class="language-json">{
  "success": false,
  "message": "Invalid phone number format"
}</code></pre>
            </div>
          </div>
          
          <!-- Get Messages Endpoint -->
          <div class="api-endpoint mb-4">
            <div class="api-endpoint-header d-flex align-items-center">
              <span class="badge bg-primary me-2 endpoint-method">GET</span>
              <span class="endpoint-path fw-bold">/api/whatsapp/messages</span>
              <span class="ms-auto"><i class="bi bi-chevron-right"></i></span>
            </div>
            <div class="api-endpoint-details mt-3 p-3 bg-light rounded">
              <p class="endpoint-description">Get messages for a session</p>
              
              <h6>Query Parameters</h6>
              <ul>
                <li><code>sessionId</code> (string, required): The session ID</li>
                <li><code>page</code> (number, optional): Page number for pagination</li>
                <li><code>limit</code> (number, optional): Number of messages per page</li>
                <li><code>phone</code> (string, optional): Filter by phone number</li>
              </ul>
              
              <h6>Response (200 OK)</h6>
              <pre><code class="language-json">{
  "success": true,
  "messages": [
    {
      "id": "string",
      "from": "string",
      "to": "string",
      "message": "string",
      "type": "text",
      "timestamp": "2023-01-01T00:00:00Z",
      "status": "sent"
    }
  ],
  "pagination": {
    "total": 100,
    "page": 1,
    "limit": 10,
    "pages": 10
  }
}</code></pre>
            </div>
          </div>
          
          <!-- Set Webhook Endpoint -->
          <div class="api-endpoint mb-4">
            <div class="api-endpoint-header d-flex align-items-center">
              <span class="badge bg-success me-2 endpoint-method">POST</span>
              <span class="endpoint-path fw-bold">/api/whatsapp/webhook/:sessionId</span>
              <span class="ms-auto"><i class="bi bi-chevron-right"></i></span>
            </div>
            <div class="api-endpoint-details mt-3 p-3 bg-light rounded">
              <p class="endpoint-description">Set a webhook URL for a session</p>
              
              <h6>Path Parameters</h6>
              <ul>
                <li><code>sessionId</code> (string, required): The session ID</li>
              </ul>
              
              <h6>Request Body</h6>
              <pre><code class="language-json">{
  "url": "string" // Webhook URL
}</code></pre>
              
              <h6>Response (200 OK)</h6>
              <pre><code class="language-json">{
  "success": true,
  "message": "Webhook URL set successfully"
}</code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- User API -->
  <div class="row api-category" data-category="user">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-header">
          <h2 class="h5 mb-0">User API</h2>
        </div>
        <div class="card-body">
          <!-- Get User Profile Endpoint -->
          <div class="api-endpoint mb-4">
            <div class="api-endpoint-header d-flex align-items-center">
              <span class="badge bg-primary me-2 endpoint-method">GET</span>
              <span class="endpoint-path fw-bold">/api/user/profile</span>
              <span class="ms-auto"><i class="bi bi-chevron-right"></i></span>
            </div>
            <div class="api-endpoint-details mt-3 p-3 bg-light rounded">
              <p class="endpoint-description">Get the current user's profile</p>
              
              <h6>Response (200 OK)</h6>
              <pre><code class="language-json">{
  "success": true,
  "user": {
    "id": 1,
    "username": "user",
    "email": "user@example.com",
    "role": "user",
    "created_at": "2023-01-01T00:00:00Z"
  }
}</code></pre>
            </div>
          </div>
          
          <!-- Update User Profile Endpoint -->
          <div class="api-endpoint mb-4">
            <div class="api-endpoint-header d-flex align-items-center">
              <span class="badge bg-success me-2 endpoint-method">POST</span>
              <span class="endpoint-path fw-bold">/api/user/profile</span>
              <span class="ms-auto"><i class="bi bi-chevron-right"></i></span>
            </div>
            <div class="api-endpoint-details mt-3 p-3 bg-light rounded">
              <p class="endpoint-description">Update the current user's profile</p>
              
              <h6>Request Body</h6>
              <pre><code class="language-json">{
  "username": "string",
  "email": "string"
}</code></pre>
              
              <h6>Response (200 OK)</h6>
              <pre><code class="language-json">{
  "success": true,
  "message": "Profile updated successfully",
  "user": {
    "id": 1,
    "username": "updateduser",
    "email": "updated@example.com",
    "role": "user"
  }
}</code></pre>
            </div>
          </div>
          
          <!-- Change Password Endpoint -->
          <div class="api-endpoint mb-4">
            <div class="api-endpoint-header d-flex align-items-center">
              <span class="badge bg-success me-2 endpoint-method">POST</span>
              <span class="endpoint-path fw-bold">/api/user/password</span>
              <span class="ms-auto"><i class="bi bi-chevron-right"></i></span>
            </div>
            <div class="api-endpoint-details mt-3 p-3 bg-light rounded">
              <p class="endpoint-description">Change the current user's password</p>
              
              <h6>Request Body</h6>
              <pre><code class="language-json">{
  "currentPassword": "string",
  "newPassword": "string"
}</code></pre>
              
              <h6>Response (200 OK)</h6>
              <pre><code class="language-json">{
  "success": true,
  "message": "Password changed successfully"
}</code></pre>
              
              <h6>Response (400 Bad Request)</h6>
              <pre><code class="language-json">{
  "success": false,
  "message": "Current password is incorrect"
}</code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin API -->
  <div class="row api-category" data-category="admin">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-header">
          <h2 class="h5 mb-0">Admin API</h2>
        </div>
        <div class="card-body">
          <!-- Get Users Endpoint -->
          <div class="api-endpoint mb-4">
            <div class="api-endpoint-header d-flex align-items-center">
              <span class="badge bg-primary me-2 endpoint-method">GET</span>
              <span class="endpoint-path fw-bold">/api/admin/users</span>
              <span class="ms-auto"><i class="bi bi-chevron-right"></i></span>
            </div>
            <div class="api-endpoint-details mt-3 p-3 bg-light rounded">
              <p class="endpoint-description">Get all users (admin only)</p>
              
              <h6>Query Parameters</h6>
              <ul>
                <li><code>page</code> (number, optional): Page number for pagination</li>
                <li><code>limit</code> (number, optional): Number of users per page</li>
                <li><code>search</code> (string, optional): Search by username or email</li>
              </ul>
              
              <h6>Response (200 OK)</h6>
              <pre><code class="language-json">{
  "success": true,
  "users": [
    {
      "id": 1,
      "username": "admin",
      "email": "admin@example.com",
      "role": "admin",
      "created_at": "2023-01-01T00:00:00Z"
    },
    {
      "id": 2,
      "username": "user",
      "email": "user@example.com",
      "role": "user",
      "created_at": "2023-01-01T00:00:00Z"
    }
  ],
  "pagination": {
    "total": 2,
    "page": 1,
    "limit": 10,
    "pages": 1
  }
}</code></pre>
              
              <h6>Response (403 Forbidden)</h6>
              <pre><code class="language-json">{
  "success": false,
  "message": "Access denied"
}</code></pre>
            </div>
          </div>
          
          <!-- Create User Endpoint -->
          <div class="api-endpoint mb-4">
            <div class="api-endpoint-header d-flex align-items-center">
              <span class="badge bg-success me-2 endpoint-method">POST</span>
              <span class="endpoint-path fw-bold">/api/admin/users</span>
              <span class="ms-auto"><i class="bi bi-chevron-right"></i></span>
            </div>
            <div class="api-endpoint-details mt-3 p-3 bg-light rounded">
              <p class="endpoint-description">Create a new user (admin only)</p>
              
              <h6>Request Body</h6>
              <pre><code class="language-json">{
  "username": "string",
  "email": "string",
  "password": "string",
  "role": "user" // or "admin"
}</code></pre>
              
              <h6>Response (201 Created)</h6>
              <pre><code class="language-json">{
  "success": true,
  "message": "User created successfully",
  "user": {
    "id": 3,
    "username": "newuser",
    "email": "newuser@example.com",
    "role": "user"
  }
}</code></pre>
            </div>
          </div>
          
          <!-- Dashboard Stats Endpoint -->
          <div class="api-endpoint mb-4">
            <div class="api-endpoint-header d-flex align-items-center">
              <span class="badge bg-primary me-2 endpoint-method">GET</span>
              <span class="endpoint-path fw-bold">/api/admin/dashboard/stats</span>
              <span class="ms-auto"><i class="bi bi-chevron-right"></i></span>
            </div>
            <div class="api-endpoint-details mt-3 p-3 bg-light rounded">
              <p class="endpoint-description">Get dashboard statistics (admin only)</p>
              
              <h6>Response (200 OK)</h6>
              <pre><code class="language-json">{
  "success": true,
  "stats": {
    "totalUsers": 10,
    "activeSessions": 5,
    "totalMessages": 1000,
    "systemStatus": {
      "cpu": 25,
      "memory": 40,
      "disk": 30,
      "uptime": "10 days, 5 hours"
    }
  },
  "recentUsers": [...],
  "recentSessions": [...],
  "messageActivity": {
    "labels": ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
    "values": [10, 20, 15, 25, 30, 20, 15]
  }
}</code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Code Examples Section -->
  <div class="row">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-header">
          <h2 class="h5 mb-0">Code Examples</h2>
        </div>
        <div class="card-body">
          <ul class="nav nav-tabs" id="codeExampleTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="javascript-tab" data-bs-toggle="tab" data-bs-target="#javascript" type="button" role="tab" aria-controls="javascript" aria-selected="true">JavaScript</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="php-tab" data-bs-toggle="tab" data-bs-target="#php" type="button" role="tab" aria-controls="php" aria-selected="false">PHP</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="python-tab" data-bs-toggle="tab" data-bs-target="#python" type="button" role="tab" aria-controls="python" aria-selected="false">Python</button>
            </li>
          </ul>
          <div class="tab-content p-3 bg-light" id="codeExampleTabsContent">
            <div class="tab-pane fade show active" id="javascript" role="tabpanel" aria-labelledby="javascript-tab">
              <h5>Authentication and Sending a Message</h5>
              <pre><code class="language-javascript">// Login and get token
async function login() {
  const response = await fetch('https://your-domain.com/api/auth/login', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      username: 'your_username',
      password: 'your_password'
    })
  });
  
  const data = await response.json();
  return data.token;
}

// Send a WhatsApp message
async function sendMessage(token, sessionId, phoneNumber, message) {
  const response = await fetch(`https://your-domain.com/api/whatsapp/session/${sessionId}/send`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      to: phoneNumber,
      message: message
    })
  });
  
  return await response.json();
}

// Usage
async function main() {
  try {
    const token = await login();
    const result = await sendMessage(token, 'your_session_id', '+1234567890', 'Hello from API!');
    console.log(result);
  } catch (error) {
    console.error('Error:', error);
  }
}

main();</code></pre>
            </div>
            <div class="tab-pane fade" id="php" role="tabpanel" aria-labelledby="php-tab">
              <h5>Authentication and Sending a Message</h5>
              <pre><code class="language-php">&lt;?php
// Login and get token
function login() {
  $url = 'https://your-domain.com/api/auth/login';
  $data = array(
    'username' => 'your_username',
    'password' => 'your_password'
  );
  
  $options = array(
    'http' => array(
      'header'  => "Content-type: application/json\r\n",
      'method'  => 'POST',
      'content' => json_encode($data)
    )
  );
  
  $context  = stream_context_create($options);
  $result = file_get_contents($url, false, $context);
  
  if ($result === FALSE) {
    throw new Exception('Error logging in');
  }
  
  $response = json_decode($result, true);
  return $response['token'];
}

// Send a WhatsApp message
function sendMessage($token, $sessionId, $phoneNumber, $message) {
  $url = "https://your-domain.com/api/whatsapp/session/$sessionId/send";
  $data = array(
    'to' => $phoneNumber,
    'message' => $message
  );
  
  $options = array(
    'http' => array(
      'header'  => "Content-type: application/json\r\nAuthorization: Bearer $token\r\n",
      'method'  => 'POST',
      'content' => json_encode($data)
    )
  );
  
  $context  = stream_context_create($options);
  $result = file_get_contents($url, false, $context);
  
  if ($result === FALSE) {
    throw new Exception('Error sending message');
  }
  
  return json_decode($result, true);
}

// Usage
try {
  $token = login();
  $result = sendMessage($token, 'your_session_id', '+1234567890', 'Hello from API!');
  print_r($result);
} catch (Exception $e) {
  echo 'Error: ' . $e->getMessage();
}
?&gt;</code></pre>
            </div>
            <div class="tab-pane fade" id="python" role="tabpanel" aria-labelledby="python-tab">
              <h5>Authentication and Sending a Message</h5>
              <pre><code class="language-python">import requests
import json

# Login and get token
def login():
    url = 'https://your-domain.com/api/auth/login'
    data = {
        'username': 'your_username',
        'password': 'your_password'
    }
    
    response = requests.post(url, json=data)
    response.raise_for_status()
    
    result = response.json()
    return result['token']

# Send a WhatsApp message
def send_message(token, session_id, phone_number, message):
    url = f'https://your-domain.com/api/whatsapp/session/{session_id}/send'
    headers = {
        'Content-Type': 'application/json',
        'Authorization': f'Bearer {token}'
    }
    data = {
        'to': phone_number,
        'message': message
    }
    
    response = requests.post(url, headers=headers, json=data)
    response.raise_for_status()
    
    return response.json()

# Usage
try:
    token = login()
    result = send_message(token, 'your_session_id', '+1234567890', 'Hello from API!')
    print(json.dumps(result, indent=2))
except Exception as e:
    print(f'Error: {str(e)}')</code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/highlight.min.js"></script>
<script src="/js/api-docs.js"></script>

<%- include('./partials/footer') %>